<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Struk Transaksi • Event Produk Digital</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22c55e;
      --danger: #ef4444;
      --border: #1f2937;
    }
    * { box-sizing: border-box }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans";
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }
    .wrap {
      max-width: 480px; margin: 0 auto;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--border);
      border-radius: 16px; overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .header {
      display: flex; align-items: center; gap: 16px;
      padding: 20px 20px; border-bottom: 1px solid var(--border);
      background: linear-gradient(90deg, rgba(34,197,94,.12), transparent);
    }
    .check {
      width: 48px; height: 48px; border-radius: 999px;
      display: grid; place-items: center;
      background: rgba(34,197,94,.15);
      border: 1px solid rgba(34,197,94,.35);
    }
    .title h1 {
      margin: 0; font-size: 20px; line-height: 2;
    }
    .badge {
      display: inline-flex; gap: 8px; align-items: center;
      font-size: 12px; letter-spacing: .3px;
      padding: 6px 10px; border-radius: 999px;
      background: rgba(34,197,94,.15); color: #bbf7d0;
      border: 1px solid rgba(34,197,94,.35);
    }
    .grid {
      display: grid; gap: 14px; padding: 18px 20px;
      grid-template-columns: 1fr;
    }
    .row { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 10px; }
    .muted { margin-bottom: 5px; color: var(--muted) }
    .hr { height: 1px; background: var(--border); margin: 6px 0 }
    .totals {
      padding: 30px 20px 20px; border-top: 1px dashed var(--border);
    }
    .row.total {
      font-size: 18px; font-weight: 700;
    }
    .row.discount { color: #86efac }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace }
    .footer {
      display: flex; gap: 10px; flex-wrap: wrap;
      padding: 16px 20px; border-top: 1px solid var(--border);
    }
    button {
      appearance: none; border: 1px solid var(--border); background: #0b1220;
      color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer;
      transition: transform .06s ease, background .2s ease, border .2s ease;
    }
    button:hover { background: #0f172a }
    button:active { transform: translateY(1px) }
    .copyable {
      display: inline-flex; gap: 8px; align-items: center;
      padding: 6px 10px; border-radius: 10px; border: 1px dashed var(--border);
      background: rgba(255,255,255,.02); cursor: pointer;
      user-select: all;
    }
    .mini {
      display: grid; gap: 6px; grid-template-columns: repeat(2, minmax(0,1fr));
    }
    .editable {
      border: 1px dashed transparent;
      padding: 2px 4px;
      border-radius: 4px;
    }
    .editable:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(34,197,94,0.1);
    }
    #time[contenteditable="true"] {
      border: 1px dashed transparent;
    }
    #time[contenteditable="true"]:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(34,197,94,0.1);
      border-radius: 6px;
    }
    @media (min-width: 560px) {
      .grid {
        grid-template-columns: 1.2fr .8fr;
      }
      .right { border-left: 1px dashed var(--border); padding-left: 20px; }
    }
    @media print {
      body { background: white; color: #111827; padding: 0 }
      .card { box-shadow: none; border: 1px solid #e5e7eb }
      .header { background: #e8fff1 }
      .badge, .check { -webkit-print-color-adjust: exact; print-color-adjust: exact }
      .footer { display: none }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="receipt">
      <!-- HEADER -->
      <div class="header">
        <div class="check" aria-hidden="true">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="11" stroke="rgba(34,197,94,.9)" stroke-width="1.6"></circle>
            <path d="M7 12.6l3 3.2 7-8" stroke="rgba(34,197,94,1)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </div>
        <div class="title">
          <h1>Transaksi Berhasil</h1>
          <div class="badge">
            <span>Ewallet</span>
            <span class="dot" style="width:6px;height:6px;border-radius:999px;background:#22c55e;display:inline-block"></span>
            <span class="time mono" id="ts">--</span>
          </div>
        </div>
      </div>

      <!-- BODY -->
      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <div class="row">
            <span class="muted">No. Referensi</span>
            <span class="copyable mono" id="ref">EVT-XXXX-XXXX</span>
          </div>
          <div class="row">
            <span class="muted">Produk</span>
            <span>ShopeePay</span>
          </div>
          <div class="row">
            <span class="muted">Metode</span>
            <span>Saldo</span>
          </div>
          <div class="row">
            <span class="muted">Status</span>
            <span>Berhasil</span>
          </div>

          <div class="hr"></div>
          <br>

          <div class="row">
            <span>Subtotal</span>
            <span class="mono editable" id="subtotal" contenteditable="true">Rp1.000.000</span>
          </div>
          <div class="row discount">
            <span>Diskon Event (15%)</span>
            <span class="mono editable" id="disc" contenteditable="true">- Rp150.000</span>
          </div>
          <div class="row">
            <span>Biaya Admin</span>
            <span class="mono editable" id="fee" contenteditable="true">Rp0</span>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="right">
          <div class="mini">
            <div>
              <div class="muted">Tanggal</div>
              <div class="mono" id="date">--/--/----</div>
            </div>
            <div>
              <div class="muted">Jam</div>
              <div class="mono" id="time" contenteditable="true">--:--</div>
            </div>
          </div>
          <div style="height:10px"></div>
          <div>
            <div class="muted">Catatan</div>
            <div class="mono" style="line-height:1.5">
              Promo event pembelian pengguna baru mitra fastpro
            </div>
          </div>
        </div>
      </div>

      <!-- TOTALS -->
      <div class="totals">
        <div class="row total">
          <span>Total Dibayar</span>
          <span class="mono" id="total">Rp850.000</span>
        </div>
      </div>

      <!-- FOOTER ACTIONS -->
      <div class="footer">
        <button onclick="window.print()">Cetak / Simpan PDF</button>
        <button id="copyBtn">Salin Ringkasan</button>
      </div>
    </div>
  </div>

  <script>
    // ==== Konfigurasi transaksi ====
    let subtotal = 1_000_000;        
    let discountPct = 15;            
    let adminFee = 0;                

    // ==== Utility ====
    const fmtIDR = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(n);
    const parseIDR = (str) => Number(str.replace(/[^0-9]/g, '')) || 0;

    function genRef() {
      const alphabet = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      const chunk = () => Array.from({length:4}, () => alphabet[Math.floor(Math.random()*alphabet.length)]).join('');
      return `EVT-${chunk()}-${chunk()}`;
    }

    let manualTime = false;

    function updateDateTime() {
      if (manualTime) return;
      const now = new Date();
      const dfDate = new Intl.DateTimeFormat('id-ID', { year:'numeric', month:'2-digit', day:'2-digit' });
      const dfTime = new Intl.DateTimeFormat('id-ID', { hour:'2-digit', minute:'2-digit' });
      document.getElementById('date').textContent = dfDate.format(now);
      document.getElementById('time').textContent = dfTime.format(now);
      document.getElementById('ts').textContent = `${dfDate.format(now)} • ${dfTime.format(now)}`;
    }

    document.getElementById('time').addEventListener('input', () => {
      manualTime = true;
      const date = document.getElementById('date').textContent.trim();
      const jam = document.getElementById('time').textContent.trim();
      document.getElementById('ts').textContent = `${date} • ${jam}`;
    });

    // ==== Hitung nilai awal ====
    function updateTotal() {
      const sub = parseIDR(document.getElementById('subtotal').textContent);
      const disc = parseIDR(document.getElementById('disc').textContent);
      const fee = parseIDR(document.getElementById('fee').textContent);
      const total = sub - disc + fee;
      document.getElementById('total').textContent = fmtIDR(total);
    }

    const discountVal = Math.round(subtotal * (discountPct/100));

    document.getElementById('subtotal').textContent = fmtIDR(subtotal);
    document.getElementById('disc').textContent = `- ${fmtIDR(discountVal)}`;
    document.getElementById('fee').textContent = fmtIDR(adminFee);
    updateTotal();
    document.getElementById('ref').textContent = genRef();
    updateDateTime();
    setInterval(updateDateTime, 1000);

    // ==== Editable angka ====
    document.querySelectorAll('.editable').forEach(el => {
      el.addEventListener('input', () => {
        let val = parseIDR(el.textContent);
        if(el.id === 'disc') {
          el.textContent = '- ' + fmtIDR(val);
        } else {
          el.textContent = fmtIDR(val);
        }
        updateTotal();
      });
    });

    // ==== Copy ringkasan ====
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const ref = document.getElementById('ref').textContent.trim();
      const date = document.getElementById('date').textContent.trim();
      const time = document.getElementById('time').textContent.trim();
      const lines = [
        '=== STRUK TRANSAKSI BERHASIL ===',
        `Ref    : ${ref}`,
        `Tanggal: ${date}`,
        `Jam    : ${time}`,
        `Produk : ShopeePay`,
        `Metode : Xtrapulsa`,
        `Subtotal: ${document.getElementById('subtotal').textContent}`,
        `Diskon (15%): ${document.getElementById('disc').textContent}`,
        `Admin  : ${document.getElementById('fee').textContent}`,
        `TOTAL  : ${document.getElementById('total').textContent}`
      ].join('\n');

      try {
        await navigator.clipboard.writeText(lines);
        const btn = document.getElementById('copyBtn');
        btn.textContent = 'Tersalin ✔';
        setTimeout(() => btn.textContent = 'Salin Ringkasan', 1500);
      } catch {
        alert('Gagal menyalin. Silakan salin manual.');
      }
    });

    document.getElementById('ref').addEventListener('click', async (e) => {
      try {
        await navigator.clipboard.writeText(e.target.textContent.trim());
        e.target.style.borderColor = 'rgba(34,197,94,.6)';
        setTimeout(()=> e.target.style.borderColor = 'var(--border)', 800);
      } catch {}
    });
  </script>
</body>
</html>
